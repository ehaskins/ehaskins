{"componentChunkName":"component---src-templates-blog-post-js","path":"/2015-11-05 Script - List Inactive Users or Computers in AD/","webpackCompilationHash":"04c9b1c30955a8ce71b4","result":{"data":{"site":{"siteMetadata":{"title":"Eric Haskins","author":"Eric Haskins"}},"markdownRemark":{"id":"e4bb0d4d-0b60-53d8-b187-25a0f9f470e7","html":"<h1>Why</h1>\n<p>I’m cleaning up an Active Directory domain, and needed to get an idea of how many computers are in use vs. inactive.</p>\n<h1>Script</h1>\n<p>I’m doing some other spluking with this, so I’m going to stick a list of all computers in a variable. I’m including the <code class=\"language-text\">lastLogonTimeStamp</code> we’re going to use to figure out which computers are active.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$rawComputers = Get-ADComputer -Filter * -Properties lastLogonTimestamp</code></pre></div>\n<p><code class=\"language-text\">lastLogonTimeStamp</code> is represented as a file timestamp, not a <code class=\"language-text\">DateTime</code>. Let’s fix that an get rid of some extra properties.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$computers = $rawComputers | select Name, DistinguishedName, Enabled, @{Name=&quot;Timestamp&quot;; Expression={[DateTime]::FromFileTime($_.lastLogonTimestamp)}}</code></pre></div>\n<p>How many have a <code class=\"language-text\">lastLogonTimeStamp</code> more than 30 days old?</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$cutoff = [DateTime]::Now.Subtract([TimeSpan]::FromDays(30))\n($computers | ? {$_.Timestamp -lt $cutoff}).Count</code></pre></div>\n<p>Let’s export that to a CSV.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$computers | ? {$_.Timestamp -lt $cutoff} | Export-CSV -NoTypeInformation -Path InactiveComputers.csv</code></pre></div>\n<h1>Resources</h1>\n<ul>\n<li><a href=\"http://blogs.technet.com/b/askds/archive/2009/04/15/the-lastlogontimestamp-attribute-what-it-was-designed-for-and-how-it-works.aspx?PageIndex=2#comments\">Ask the Directory Services Team - “The LastLogonTimeStamp Attribute” – “What it was designed for and how it works”</a></li>\n</ul>","frontmatter":{"title":"Script - List Inactive Users or Computers in AD","date":"November 05, 2015"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2015-11-05 Script - List Inactive Users or Computers in AD/"}}}